<!DOCTYPE html>
<html>

<head>
  <title>Simple Map</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
    <h1 class="select">선택</h1>
  <a class="select2">선택</a>
  <div id="map"></div>
  <!-- <script>

  </script> -->

  <!-- </body>

</html> -->

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkBTsgeRlYXc5d0X3V2OiMNwieY253YNA&callback=initMap"
    async defer></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
  <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
  <script language="javascript">
    var map;
    var position_x = 37.5516;
    var position_y = 126.9250;
    var gmarkers = [];
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 37.5516, lng: 126.9250 },
        zoom: 15
      });

      var icons = {
        bung: {
          icon: '/static/img/bunglogo.png'
        },
        atm: {
          icon: '/static/img/atmlogo.png'
        },
      };
      var features = [
        {
          position: new google.maps.LatLng(37.5516, 126.9250),
          type: 'bung',
        },
        {
          position: new google.maps.LatLng(37.5816, 126.2350),
          type: 'bung'
        },
        {
          position: new google.maps.LatLng(37.7516, 127.50),
          type: 'bung'
        },
        {
          position: new google.maps.LatLng(37.7516, 127.55),
          type: 'atm'
        },
        {
          position: new google.maps.LatLng(37.75, 127.50),
          type: 'atm'
        },
      ]

      for (var i = 0; i < features.length; i++) {
        var marker = new google.maps.Marker({
          position: features[i].position,
          icon: icons[features[i].type].icon,
          animation: google.maps.Animation.DROP,
          map: map
        });
        gmarkers.push(marker);
      };
    }

    function removeMarkers() {
      for (i = 0; i < gmarkers.length; i++) {
        gmarkers[i].setMap(null);
      }
    }
    function newLocation(newLat, newLng) {
      map.panTo({
        lat: newLat,
        lng: newLng
      });
      map.setZoom(15)
    }
    
    $('.select').on('click', function () {
      console.log('asdfasd')
      var csrftoken = $("[name=csrfmiddlewaretoken]").val();
      $.ajax({
        url: '{% url "find_food:select_loc" 2 %}',
        type: 'POST',
        headers: {
          "X-CSRFToken": csrftoken
        },
        data: {
          'csrfmiddlewaretoken': "{{ csrf_token }}",
        },
        success: function (response) {
          // for (var i = 0; i < response.length; i++)
          console.log(response.data[1])
          removeMarkers()
          position_x = response.data[0].position_x;
          position_y = response.data[0].position_y;
          newLocation(position_x, position_y);
          for (var i = 0; i < response.data[1].length; i++) {
            var marker = new google.maps.Marker({
              position: { lat: response.data[1][i].position_x, lng: response.data[1][i].position_y },
              icon: '/static/img/bunglogo.png',
              animation: google.maps.Animation.DROP,
              map: map
            });
            gmarkers.push(marker);
            var infowindow = new google.maps.InfoWindow({
              content: 'open: ' + response.data[1][i].open_time + '<br>close: ' + response.data[1][i].close_time
            });
            infowindow.open(map, marker);
          };
        },
        error: function (response) {
          console.log(response);
        }
      });
    });
  </script>

</body>

</html>